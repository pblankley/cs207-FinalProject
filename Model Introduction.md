# Chemical Kinetics Library
> Editors: Paul Blankley, Ryan Janssen, Boyuan Sun

> Date started: Oct 13, 2017

> Course: CS 207. System Development for Computational Science

> Organization: Harvard SEAS CS.207 Group 1

> Target User: Users who want to utilize the reation rate coefficients for various purposes


## I. Introduction
### 1.1 Preliminaries
Chemical reactions take place everywhere at any time. Computing the reaction rates of a particular reaction is the first and fundatmental step towards understanding the mechanics of the reaction. Various types of chemical reactions and reaction rates coefficients will be addressed in our library. The *purpose* of this chemical kinetics library is to calculate the reaction rates for species in by accepting users' input sets of chemical reactions in xml with corresponding coefficients. The library will calculate the progress rates, reaction rate coefficients including constant reaction rate coefficients, Arrhenius reaction rate coefficients, and modified Arrhenius reaction rate coefficients, and finally the reaction rates for each specie that the users have specified. Users will then choose how to use the rates given by the library afterwards.
### 1.2 Key Terminology
#### 1.2.1 Elementary reactions
[Elementary reactions] (https://en.wikipedia.org/wiki/Elementary_reaction), as indicated by the name, are the most fundamental chemical reactions in chemical kinetics. In short, if there is no intermediates found during the span of a chemical reaction, we define the reation to be elementary.

#### 1.2.2 Irreversible reactions vs. reversible reactions
[Irreversible reactions and reversible reactions](https://chem.libretexts.org/Core/Physical_and_Theoretical_Chemistry/Equilibria/Reversibility_and_Equilibria/Reversible_vs._Irreversible_Reactions) are the reactions our library focus on. Both reactions are commonly found in nature. In short, irreverisble reactions occur when the products of the reactions cannot not be converted to the previous reactants. Reversible reactions are the opposite.

#### 1.2.3 Reaction rate coefficients
Chemical reaction rates are dicussed [here](https://en.wikipedia.org/wiki/Reaction_rate_constant). In our chemical kinetics library we support three types of reaction rate coefficients: 
- Constant reaction rate coefficients

  * Defined by the constant reaction rate coefficient k. No additional calculation is needed.

- Arrhenius reaction rate coefficients

  * Detailed description can be found and formula can be found [here](https://en.wikipedia.org/wiki/Arrhenius_equation).
  
- Modified Arrhenius (a.k.a Kooij) reaction rate coefficients
  
  * Detailed description can be found and formula can be found [here](https://en.wikipedia.org/wiki/Arrhenius_equation).
  
#### 1.2.4 Progress rate and Reaction rate
[Reaction rate](https://www.britannica.com/science/reaction-rate) in general defines the speed of a chemical reaction. Reaction rates are computed by the users' defined sets of inputs for each specie given its corresponding concentration and reation rates. The definition of progress rate and reaction rate and formulas for computation can be found [here](https://github.com/IACS-CS-207/cs207-F17/blob/master/lectures/L8/L8.ipynb).

## II. Installation

We plan to migrate the project to the Anaconda cloud with PyPI for future easy install.  For a beta version of the software package, download the chemkin.py file and place the file in your working directory. You can also run the following command to clone the git repo and then move the chemkin module to your working directory.

$ git clone https://github.com/cs207-g1/cs207-FinalProject.git

Once you move chemkin.py to your working directory you can just run:

>>>import chemkin 

After that command you will have full access to the module.

## III. Basic Usage and Examples

### 3.1 General Usage
The ultimate output of the Chemical Kinetics library is to return a set of reaction rates $f$ for a given set of reactions, which is calculated by calling the *reaction_rate* method.  Intermediate outputs can be called using the *reaction_coef* method (returning the 'k' reaction coefficients for the system), or the *progress_rate* method (returning the progress rate $\omega$).

Data can be input in one of two ways: 
1. From an .xml file via the built-in *get_reactions* xml parser function, on class initiation.  XML must be in the format specified in the attached sample .xml.
2. By inputing parameters directly to the class via the *set_params* method.

All methods are implemented in the Reaction class, which will contain the necessary parameters to calculate outputs for a specified reaction temperature and species concentrations.

### 3.2 Method/Function details and examples

#### 3.2.1 Reaction(param_dict) *(class initialization)*
This class represents the entire reaction for a set of elementary reactions.  The class takes in a dictionary of parameters generated by the parser function.
  
This dictionary contains a matrix vprime and a matrix v2prime corresponding to the usual v' and v'' matrices in systems of elementary reactions, v' being reactants and v'' being reactants.
    
The dictionary also contains lists (length corresponding to the columns of v' and v'') with the values for A,b,E,k and coeftype for each elementary reaction in the system. 

NOTE: If one or more of these parameters is rendered useless or NA for a reaction it is given the value NaN. Coeftype is a list of strings containing the type of reaction.
<blockquote>
__*Args*__: 
* param_dict; where param_dict is the output from the parser function.
    
__*Returns*__: 
* None, but instantiates self

__*Raises*__: 
* ValueError when the vprime and v2prime matrices are different sizes
* ValueError if numeric parameters are not numbers
* TypeError if numerica parameters are not real numbers
* ValueError if coefficient types other than Arrhenius, modifiedArrhenius, and Constant are used
</blockquote>
<br>

#### 3.2.2 reaction_coef(self, T)
Sets reaction coefficients for the given float temperature T.  May be used externally but more commonly called by the class' own function progress_rate.
<blockquote>
__*Args*__: 
* T; float; the temperature for all reactions

__*Returns*__: 
* None

__*Raises*__: 
* ValueError when T cannot be cast to a float or T is negative
</blockquote>
<br>
        
#### 3.2.3 progress_rate(self, x, T):
This function calculates the progress rate $\omega$ of a reaction of the following form:

                    V'11*A + V'21*B -> V''31*C
                
                V'12*A + V'32*C -> V''22*B + V''32*C
                
It takes in the vectors v', v'' and x in the order [[A],[B],[C]].
<blockquote>
__*Args*__: 
* v',v''; matrices, numpy arrays of form mxn where m is the number of reactants and n is number of equations.              
* x; vector, numpy array (or list of lists) of length equal to the number of reactants in the system of equations.

__*Returns*__: 
* list of floats; the progress rate of the reaction for each equation

__*Raises*__: 
* ValueError if the shapes of the v matrices are not equal
</blockquote>
<br>
       
#### 3.2.4 reaction_rate(self,x,T):
This function calculates the reaction rate of a reaction of the following form:
                    V'11*A + V'21*B -> V''31*C
                    V'32*C -> V'12*A + V''22*B
It takes in the vectors v', v'' from the class and x in the order [[A],[B],[C]].
<blockquote>
__*Args*__: 
* x; vector, numpy array (or list) of length equal to the number of reactants in the system of equations.
* T; float, the strictly positive temperature 

__*Returns*__: 
* vector of floats; the reaction rate for each equation

__*Raises*__: 
* ValueError when temp is less than 0
</blockquote>
<br>

#### 3.2.5 set_params(self,idx,A=None,b=None,E=None,R=None, k=None, coeftype=None):
This function takes inputs of the parameters you want to set for reaction coefficient calculations.
<blockquote>
__*Args*__: 
* A,b,E,T,R; all floats and optional arguments

__*Returns*__: 
* None (updates internal class parameters)

__*Raises*__: 
* ValueError ValueError when any input given a value other than None cannot be cast to a float
</blockquote>
<br>
    
#### 3.2.6 _arrhenius(self, idx, T):
This internal function takes in the parameter T (kelvin temperature) from the class attributes, and it will return a value, k, that is the Arrhenius reaction rate coefficient.
<blockquote>
__*Args*__: 
* T, float; temperature, (gets args from class).

__*Returns*__: 
* The float k where k is the reaction rate coefficient.

__*Raises*__: 
* OverflowError after constant evaluation
* FloatingPointError after constant evaluation for underflow
</blockquote>
<br>

#### 3.2.7 _mod_arrhenius(self, idx, T):
This internal function takes in the parameter T (kelvin temperature) from the class attributes, and it will return a value, k, that is the modified Arrhenius reaction rate coefficient.
<blockquote>
__*Args*__: 
* T, float; temperature (gets args from class).

__*Returns*__: 
* The float k where k is the reaction rate coefficient.

__*Raises*__: 
* OverflowError after constant evaluation
* FloatingPointError after constant evaluation for underflow
</blockquote>
<br>

#### 3.2.8 get_reactions(name):
This function takes in the name of the input xml file, and returns a dictionary of relevant information for a set of chemical reactions.  Note this is a **function** within Chemkin and not a **method** of Reaction.
<blockquote>
__*Args*__: 
* name; name of the input .xml file

__*Returns*__: 
* reaction_dict, dictionary of data for a reaction.  Contains the following keys:
    * reaction_dict['species']; list of strings, species of the reaction
    * reaction_dict['As']; list of floats, corresponding to reaction parameter A for each equation (= NaN for any equations that don't use A.
    * reaction_dict['bs']; list of floats, corresponding to reaction parameter b for each equation (= NaN for any equations that don't use b.
    * reaction_dict['Es']; list of floats, corresponding to reaction parameter E for each equation (= NaN for any equations that don't use E.
    * reaction_dict['ks']; list of floats, corresponding to reaction parameter k for each equation (= NaN for any equations that don't use k (ie, non-constant equations)).
    * reaction_dict['rxn_types']; List of strings. Elements Correspond to same reactions as reaction_parameters.  Each string is one of { 'Arrhenius', 'modifiedArrhenius', 'Constant' }
    * reaction_dict['vprime']; np array, full vprime matrix of all reactions in the xml file
    * reaction_dict['v2prime']; np array, full v2prime matrix of all reactions in the xml file
    
__*Raises*__: 
* FileNotFoundError if name is not a valid .xml path
* ValueError if xml is not in specified data format
</blockquote>
<br>



### 3.3 Sample .xml format
All .xml reaction files should follow the sample format used below.  Source and Designer of this format is David Sondak, Harvard University CS207:

```
<?xml version="1.0"?>

<ctml>

    <phase>
        <speciesArray> H O OH H2 H2O O2 </speciesArray>
    </phase>

    <reactionData id="test_mechanism">

        <!-- reaction 01  -->
        <reaction reversible="no" type="Elementary" id="reaction01">
            <equation>H + O2 =] OH + O</equation>
            <rateCoeff>
                <Arrhenius>
                    <A>3.52e+10</A>
                    <E>7.14e+04</E>
                </Arrhenius>
            </rateCoeff>
            <reactants>H:1 O2:1</reactants>
            <products>OH:1 O:1</products>
        </reaction>

        <!-- reaction 02 -->
        <reaction reversible="no" type="Elementary" id="reaction02">
            <equation>H2 + O =] OH + H</equation>
            <rateCoeff>
                <modifiedArrhenius>
                    <A>5.06e-2</A>
                    <b>2.7</b>
                    <E>2.63e+04</E>
                </modifiedArrhenius>
            </rateCoeff>
            <reactants>H2:1 O:1</reactants>
            <products>OH:1 H:1</products>
        </reaction>

        <!-- reaction 03 -->
        <reaction reversible="no" type="Elementary" id="reaction03">
            <equation>H2 + OH =] H2O + H</equation>
            <rateCoeff>
                <Constant>
                    <k>1.0e+03</k>
                </Constant>
            </rateCoeff>
            <reactants>H2:1 OH:1</reactants>
            <products>H2O:1 H:1</products>
        </reaction>

    </reactionData>

</ctml>
```







    =========
    Examples:
    # Example with the reaction rate
        
    >>> vp = np.array([[1.,2.],[2.,0.],[0.,2.]])
    >>> vpp = np.array([[0.,0.],[0.,1.],[2.,1.]])
    >>> pdict = {'vprime': vp, 'v2prime': vpp, 'A': [float('nan'),float('nan')], \
                'b': [float('nan'),float('nan')], 'E': [float('nan'),float('nan')], \
                'k': [10,10], 'coeftype': ['Constant','Constant']}
    >>> rrr = Reaction(pdict)
    >>> rrr.reaction_rate(np.array([[1.],[2.],[1.]]),10)
    [-60.0, -70.0, 70.0]
    
    # Example with the progress rate 
    
    >>> vp = np.array([[1.,2.],[2.,0.],[0.,2.]])
    >>> vpp = np.array([[0.,0.],[0.,1.],[2.,1.]])
    >>> pdict = {'vprime': vp, 'v2prime': vpp, 'A': [float('nan'),float('nan')], \
                'b': [float('nan'),float('nan')], 'E': [float('nan'),float('nan')], \
                'k': [10,10], 'coeftype': ['Constant','Constant']}
    >>> rrr = Reaction(pdict)
    >>> rrr.progress_rate(np.array([[1.],[2.],[1.]]),10)
    [40.0, 10.0]
    
    # Example with reaction coef 
    
    >>> vp = np.array([[1.,2.],[2.,0.],[0.,2.]])
    >>> vpp = np.array([[0.,0.],[0.,1.],[2.,1.]])
    >>> pdict = {'vprime': vp, 'v2prime': vpp, 'A': [.00045,.00045], \
                'b': [1.2,1.2], 'E': [1.7,1.7], \
                'k': [float('nan'),float('nan')], 'coeftype': ['Arrhenius','modifiedArrhenius']}
    >>> rrr = Reaction(pdict)
    >>> rrr.reaction_coef(900)
    [0.00044989777442266471, 1.5783556022951033]
    
    # Example with set params
    
    >>> vp = np.array([[1.,2.],[2.,0.],[0.,2.]])
    >>> vpp = np.array([[0.,0.],[0.,1.],[2.,1.]])
    >>> pdict = {'vprime': vp, 'v2prime': vpp, 'A': [.00045,.00045], \
                'b': [1.2,1.2], 'E': [1.7,1.7], \
                'k': [float('nan'),float('nan')], 'coeftype': ['Arrhenius','modifiedArrhenius']}
    >>> rrr = Reaction(pdict)
    >>> w = rrr.reaction_coef(900)
    >>> ww = rrr.set_params(1,k=10, coeftype='Constant')
    >>> rrr.reaction_coef(900)
    [0.00044989777442266471, 10.0]